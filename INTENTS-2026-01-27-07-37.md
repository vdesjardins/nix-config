# Intent: Fix overlayfs mount failure in opencode-sandbox

## Problem
The opencode-sandbox binary was failing with "must be superuser to use mount" error when trying to mount overlayfs at `/tmp/.opencode-$sandbox_id/nix-store`. This prevented unprivileged users from using the sandbox.

## Solution
Implemented **Option 3** from the design options: use bubblewrap's built-in `--tmpfs` and bind mount features directly instead of pre-mounting overlayfs.

### Changes Made

1. **create_nix_store_overlay()**: Simplified to only create the overlay changes directory without attempting to mount overlayfs. Returns the upper directory path for bubblewrap to use.

2. **create_home_overlay()**: Simplified similarly to only prepare the home overlay changes directory without mounting.

3. **cleanup_mounts()**: Simplified to only remove sandbox directories (no unmount operations needed since bubblewrap manages tmpfs internally).

4. **main()**: Updated to:
   - Use `--tmpfs /nix` to create isolated /nix namespace in bubblewrap
   - Bind-mount `/nix/store` as read-only from host
   - Use separate tmpfs for `/home/opencode` instead of mounting overlay
   - Bind-mount original home directory as read-only
   - Removed overlayfs mount operations entirely

## Benefits
- **No root required**: Eliminates all privileged operations
- **Simpler code**: No mount/unmount complexity
- **Better isolation**: bubblewrap manages namespace isolation properly
- **Cleaner semantics**: Changes are naturally isolated per sandbox session

## Why This Works
Bubblewrap creates isolated mount namespaces where tmpfs and bind mounts provide the necessary isolation. The write layer is implicit in the tmpfs - anything written goes there and is automatically cleaned up when the container exits. This is much simpler than pre-mounting overlayfs and passing it in.
