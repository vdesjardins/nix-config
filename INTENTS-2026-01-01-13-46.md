# Simplify Grafana datasource references by updating dashboard JSON

## Prompt
Is it also an option to modify the uid for VictoriaLogs in the dashboard json file?

## Answer & Implementation
Yes! This is actually a **cleaner approach** than using Nix datasource replacement transforms. By updating the dashboard JSON to use the standard datasource name, the Nix configuration becomes simpler and more maintainable.

## Changes Made

### 1. Dashboard JSON Update
**File:** `hosts/modules/linux/shared/grafana/dashboards/opnsense-ids.json`

Updated all datasource references from the old auto-generated UID to the standard name:
- **Before:** `"uid": "PD775F2863313E6C7"` (old manual datasource UID)
- **After:** `"uid": "VictoriaLogs"` (provisioned datasource name)

**Command used:**
```bash
jq '(.. | objects | select(.uid == "PD775F2863313E6C7") | .uid) |= "VictoriaLogs"'
```

### 2. Simplified Nix Configuration
**File:** `hosts/modules/linux/shared/grafana/default.nix`

Removed unnecessary datasource replacement transform since the dashboard now references the correct datasource names directly.

**Before:**
```nix
opnsense-ids = {
  path = ./dashboards/opnsense-ids.json;
  transform = dashboard:
    lib.pipe dashboard [
      (dashLib.setUid "opnsense-ids")
      (dashLib.replaceDatasources [
        {
          key = "PD775F2863313E6C7";
          value = "VictoriaLogs";
        }
      ])
    ];
};
```

**After:**
```nix
opnsense-ids = {
  path = ./dashboards/opnsense-ids.json;
  transform = dashboard:
    lib.pipe dashboard [
      (dashLib.setUid "opnsense-ids")
    ];
};
```

### 3. Verification
- ✅ All `PD775F2863313E6C7` references replaced with `VictoriaLogs`
- ✅ Dashboard now references only standard provisioned datasource names:
  - `VictoriaLogs` (type: loki)
  - `VictoriaLogs` (type: victoriametrics-logs-datasource)
- ✅ Nix config simplified - no datasource replacement needed
- ✅ Configuration is more portable and maintainable

## Benefits of This Approach

1. **Cleaner Nix Configuration** - Removed unnecessary datasource transformations
2. **Better Portability** - Dashboard references standard datasource names instead of hardcoded UIDs
3. **Easier Maintenance** - Datasource mappings are now explicit in the dashboard JSON
4. **Consistent with Best Practices** - Aligns with Grafana's recommended approach for dashboard provisioning

## Future Deployments
The simplified configuration means:
- Dashboard will automatically use the provisioned "VictoriaLogs" datasource
- No need to track or update datasource UIDs when rebuilding Grafana
- Dashboard is more reusable across different Grafana instances
